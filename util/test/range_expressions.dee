#!/usr/bin/deemon
/* Copyright (c) 2018 Griefer@Work                                            *
 *                                                                            *
 * This software is provided 'as-is', without any express or implied          *
 * warranty. In no event will the authors be held liable for any damages      *
 * arising from the use of this software.                                     *
 *                                                                            *
 * Permission is granted to anyone to use this software for any purpose,      *
 * including commercial applications, and to alter it and redistribute it     *
 * freely, subject to the following restrictions:                             *
 *                                                                            *
 * 1. The origin of this software must not be misrepresented; you must not    *
 *    claim that you wrote the original software. If you use this software    *
 *    in a product, an acknowledgement in the product documentation would be  *
 *    appreciated but is not required.                                        *
 * 2. Altered source versions must be plainly marked as such, and must not be *
 *    misrepresented as being the original software.                          *
 * 3. This notice may not be removed or altered from any source distribution. *
 */

import * from deemon;

function assert_range(r,e) {
	assert r == e;
	assert (!!r) == (!!e), "{!r}, {!r}".format({
		r as sequence,
		e as sequence
	});
	local n = #e;
	assert #r == n;
	for (local i = 0; i < n; ++i)
		assert r[i] == e[i];
	for (local x: e)
		assert x in r;
}

class IntWrapper: numeric {
	public final member i: int = 0;
	this = default;
	operator ++ () { return IntWrapper(i + 1); }
	operator -- () { return IntWrapper(i - 1); }
	operator bool(): bool {
		return !!i;
	}
	operator + (): IntWrapper -> IntWrapper(+i);
	operator - (): IntWrapper -> IntWrapper(-i);
	operator + (x: IntWrapper): IntWrapper -> IntWrapper(i + (x is IntWrapper ? x.i : x));
	operator - (x: IntWrapper): IntWrapper -> IntWrapper(i - (x is IntWrapper ? x.i : x));
	operator * (x: IntWrapper): IntWrapper -> IntWrapper(i * (x is IntWrapper ? x.i : x));
	operator / (x: IntWrapper): IntWrapper -> IntWrapper(i / (x is IntWrapper ? x.i : x));
	operator % (x: IntWrapper): IntWrapper -> IntWrapper(i % (x is IntWrapper ? x.i : x));
	operator <  (x: IntWrapper): bool -> i <  (x is IntWrapper ? x.i : x);
	operator <= (x: IntWrapper): bool -> i <= (x is IntWrapper ? x.i : x);
	operator == (x: IntWrapper): bool -> i == (x is IntWrapper ? x.i : x);
	operator != (x: IntWrapper): bool -> i != (x is IntWrapper ? x.i : x);
	operator >  (x: IntWrapper): bool -> i >  (x is IntWrapper ? x.i : x);
	operator >= (x: IntWrapper): bool -> i >= (x is IntWrapper ? x.i : x);
}

assert !!IntWrapper(10);

assert_range([0:7],{0,1,2,3,4,5,6});
assert_range([0:7,1],{0,1,2,3,4,5,6});
assert_range([0:7,2],{0,2,4,6});
assert_range([0:7,3],{0,3,6});
assert_range([0:7,-1],{});
assert_range([0:7,-2],{});
assert_range([0:7,-3],{});
assert_range([7:0],{});
assert_range([7:0,1],{});
assert_range([7:0,2],{});
assert_range([7:0,3],{});
assert_range([7:0,-1],{7,6,5,4,3,2,1});
assert_range([7:0,-2],{7,5,3,1});
assert_range([7:0,-3],{7,4,1});

assert_range([IntWrapper(0):IntWrapper(7)],{0,1,2,3,4,5,6});
assert_range([IntWrapper(0):IntWrapper(7),IntWrapper(1)],{0,1,2,3,4,5,6});
assert_range([IntWrapper(0):IntWrapper(7),IntWrapper(2)],{0,2,4,6});
assert_range([IntWrapper(0):IntWrapper(7),IntWrapper(3)],{0,3,6});
assert_range([IntWrapper(0):IntWrapper(7),IntWrapper(-1)],{});
assert_range([IntWrapper(0):IntWrapper(7),IntWrapper(-2)],{});
assert_range([IntWrapper(0):IntWrapper(7),IntWrapper(-3)],{});
assert_range([IntWrapper(7):IntWrapper(0)],{});
assert_range([IntWrapper(7):IntWrapper(0),IntWrapper(1)],{});
assert_range([IntWrapper(7):IntWrapper(0),IntWrapper(2)],{});
assert_range([IntWrapper(7):IntWrapper(0),IntWrapper(3)],{});
assert_range([IntWrapper(7):IntWrapper(0),IntWrapper(-1)],{7,6,5,4,3,2,1});
assert_range([IntWrapper(7):IntWrapper(0),IntWrapper(-2)],{7,5,3,1});
assert_range([IntWrapper(7):IntWrapper(0),IntWrapper(-3)],{7,4,1});











