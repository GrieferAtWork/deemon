/* Copyright (c) 2018 Griefer@Work                                            *
 *                                                                            *
 * This software is provided 'as-is', without any express or implied          *
 * warranty. In no event will the authors be held liable for any damages      *
 * arising from the use of this software.                                     *
 *                                                                            *
 * Permission is granted to anyone to use this software for any purpose,      *
 * including commercial applications, and to alter it and redistribute it     *
 * freely, subject to the following restrictions:                             *
 *                                                                            *
 * 1. The origin of this software must not be misrepresented; you must not    *
 *    claim that you wrote the original software. If you use this software    *
 *    in a product, an acknowledgement in the product documentation would be  *
 *    appreciated but is not required.                                        *
 * 2. Altered source versions must be plainly marked as such, and must not be *
 *    misrepresented as being the original software.                          *
 * 3. This notice may not be removed or altered from any source distribution. *
 */

#define DEFINE(x)     C_FLAGS("-D"+x)
#define INCLUDE(x)    P_FLAGS("-I"+FILES(x)[0])
#define LIBPATH(x)    L_FLAGS("-L"+FILES(x)[0])
#define LIB(x)        L_FLAGS("-l"+(x))
#define SET_OUTPUT_DLL(x) \
	CREATE_FOLDER(fs.path.head(x)) \
	IF(TARGET_WINDOWS) \
		SET_OUTPUT((x)+".dll") \
		L_FLAGS("-Wl,--out-implib="+FILES(x)[0]+".dll.a") \
	ELSE \
		SET_OUTPUT((x)+".so") \
	FI \

#define SET_OUTPUT_EXE(x) \
	CREATE_FOLDER(fs.path.head(x)) \
	IF(TARGET_WINDOWS) \
		SET_OUTPUT(x+".exe") \
		L_FLAGS("-Wl,--out-implib="+FILES(x)[0]+".dll.a") \
	ELSE \
		SET_OUTPUT(x) \
	FI


IF(NOT CONFIG_NDEBUG)
	DEFOPT(CONFIG_DEBUG)
FI

IF(NOT CROSS_PREFIX)
	IF(TARGET_WINDOWS)
		IF($TARGET_CPU == i?86)
			DEFOPTAS(CROSS_PREFIX,"i686-w64-mingw32-")
			//DEFOPTAS(CROSS_PREFIX,"i686-pc-cygwin-")
		FI
	FI
FI

/* Default compiler settings based on target/config/option flags. */
IF(TARGET_WINDOWS)
	DEFINE("__PE__")
FI
IF(CONFIG_OPTIMIZE)
	C_FLAGS("-O3")
	L_FLAGS("-O3")
ELSE
	C_FLAGS("-fstack-protector-strong","-g")
	L_FLAGS("-fstack-protector-strong","-g")
FI
IF(NOT CONFIG_DEBUG)
	C_FLAGS("-DNDEBUG")
FI
INCLUDE("/include")

IF(NOT WITHOUT_KOS_HEADERS)
	INCLUDE("/include/deemon/kos-headers")
FI

C_FLAGS("-Wall")
C_FLAGS("-Wextra")
C_FLAGS("-Wno-address")
C_FLAGS("-Wno-unused-value")
C_FLAGS("-Wno-nonnull-compare")
C_FLAGS("-Wno-unused-parameter")
C_FLAGS("-Wno-comment")
C_FLAGS("-Wno-strict-aliasing")
C_FLAGS("-Wno-missing-field-initializers")
C_FLAGS("-Wno-type-limits")
C_FLAGS("-Wno-maybe-uninitialized")

#include "src/.sources"

